{"version":3,"sources":["vminpoly.coffee"],"names":[],"mappings":"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","file":"vminpoly.js","sourceRoot":"/source/","sourcesContent":["XMLHttpFactories = [\n  -> new XMLHttpRequest(),\n  -> new ActiveXObject(\"Msxml2.XMLHTTP\"),\n  -> new ActiveXObject(\"Msxml3.XMLHTTP\"),\n  -> new ActiveXObject(\"Microsoft.XMLHTTP\")]\n\ncreateXMLHTTPObject = ->\n  xmlhttp = false\n  i = 0\n\n  while i < XMLHttpFactories.length\n    try\n      xmlhttp = XMLHttpFactories[i++]()\n    catch e\n      continue\n    break\n  xmlhttp\n\n##toCamelCase = (s) ->\n##  s.replace(/-([a-z])/g, (g) ->\n##    return g[1].toUpperCase()\n\najax = (url, onload) ->\n  xmlhttp = createXMLHTTPObject()\n  xmlhttp.onreadystatechange = ->\n    unless xmlhttp.readyState is 4\n      return\n    unless xmlhttp.status is 200 || url.match(/^file:\\/\\/\\//)\n      throw \"Error!\"\n    console.log \"INFO: processing #{url}\"\n    onload xmlhttp.responseText\n    return\n  try\n    xmlhttp.open \"GET\", url, true\n    xmlhttp.send()\n  catch e\n    console.log \"ERROR: #{e.message} (#{e.type}) when accessing #{url}\"\n  return\n\n# get window dimensions, cross-browser compatible\n# Thanks to: Stefano Gargiulo\ngetViewportSize = ->\n  x = 0\n  y = 0\n  if window.innerHeight # all except Explorer < 9\n    x = window.innerWidth\n    y = window.innerHeight\n  else if document.documentElement and document.documentElement.clientHeight\n    # Explorer 6 Strict Mode\n    x = document.documentElement.clientWidth\n    y = document.documentElement.clientHeight\n  else if document.body # other Explorers < 9\n    x = document.body.clientWidth\n    y = document.body.clientHeight\n  width: x\n  height: y\n\ninitLayoutEngine = () ->\n  analyzeStyleRule = (rule) ->\n    declarations = []\n    for declaration in rule.value\n      hasDimension = false\n      for token in declaration.value\n        if token.tokenType is 'DIMENSION' and (token.unit is 'vmin' or token.unit is 'vh' or token.unit is 'vw')\n          hasDimension = true\n      if hasDimension\n        declarations.push declaration\n    rule.value = declarations\n    declarations\n  analyzeStylesheet = (sheet) ->\n    rules = []\n    for rule in sheet.value\n      switch rule.type\n        when 'STYLE-RULE'\n          decs = analyzeStyleRule rule\n          unless decs.length is 0\n            rules.push rule\n        when 'AT-RULE'\n          atRules = analyzeStylesheet rule\n          unless atRules.length is 0\n            rules.push rule\n    sheet.value = rules\n    rules\n\n  onresize = ->\n    vpDims = getViewportSize()\n\n    dims =\n      vh: vpDims.height / 100\n      vw: vpDims.width / 100\n    dims.vmin = Math.min dims.vh, dims.vw\n\n    vpAspectRatio = vpDims.width / vpDims.height\n\n    map = (a, f) ->\n      if a.map?\n        a.map f\n      else\n        a1 = []\n        for e in a\n          a1.push f e\n        a1\n\n    generateRuleCode = (rule) ->\n      declarations = []\n\n      ruleCss = (map rule.selector, (o) -> if o.toSourceString? then o.toSourceString() else '').join ''\n      ruleCss += \"{\"\n      for declaration in rule.value\n        ruleCss += declaration.name\n        ruleCss += \":\"\n        for token in declaration.value\n          if token.tokenType is 'DIMENSION' and (token.unit is 'vmin' or token.unit is 'vh' or token.unit is 'vw')\n            ruleCss += \"#{Math.floor(token.num*dims[token.unit])}px\"\n          else\n            ruleCss += token.toSourceString()\n        ruleCss += \";\"\n      ruleCss += \"}\\r\"\n      ruleCss\n    generateSheetCode = (sheet) ->\n      sheetCss = ''\n      for rule in sheet.value\n        switch rule.type\n          when 'STYLE-RULE'\n            sheetCss += generateRuleCode rule\n          when 'AT-RULE'\n            if rule.name is 'media'\n              prelude = ''\n              mar = false\n              nums = []\n              for t in rule.prelude\n                if t.name is '('\n                  prelude += '('\n                  for t1 in t.value\n                    source = if t1.toSourceString? then t1.toSourceString() else ''\n                    if t1.tokenType is 'IDENT' and source is 'max-aspect-ratio'\n                      mar = true\n                    if t1.tokenType is 'NUMBER'\n                      nums.push parseInt source\n\n                    prelude += source\n                  #prelude += (map t.value, (o) -> if o.toSourceString? then o.toSourceString() else '').join ''\n                  #prelude += t.value.join ''\n                  prelude += ')'\n                else\n                  prelude += t.toSourceString()\n              if vpAspectRatio < nums[0] / nums[1]\n                sheetCss += generateSheetCode rule\n            else\n              prelude = ''\n              for t in rule.prelude\n                if t.name is '('\n                  prelude += '('\n                  prelude += (map t.value, (o) -> if o.toSourceString? then o.toSourceString() else '').join ''\n                  #prelude += t.value.join ''\n                  prelude += ')'\n                else\n                  prelude += t.toSourceString()\n              sheetCss += \"@#{rule.name} #{prelude} {\"\n              sheetCss += generateSheetCode rule\n              sheetCss += '}\\n'\n      sheetCss\n    css = ''\n    for url, sheet of sheets\n      css += generateSheetCode sheet\n    if styleElement.styleSheet?\n      styleElement.styleSheet.cssText = css\n    else\n      styleElement.innerHTML = css\n\n  sheets = {}\n  styleElement = document.createElement 'style'\n  head = document.getElementsByTagName('head')[0]\n  head.appendChild styleElement\n\n  links = document.getElementsByTagName 'link'\n  innerSheetCount = 0;\n  outerSheetCount = 0;\n  for i in links\n    unless i.rel is 'stylesheet'\n      continue\n    innerSheetCount++;\n    ajax i.href, (cssText) ->\n      tokenlist = tokenize cssText\n      sheet = parse tokenlist\n      analyzeStylesheet sheet\n      sheets[i.href] = sheet\n      outerSheetCount++\n      if outerSheetCount is innerSheetCount\n        window.onresize()\n      return\n\n  window.onresize = onresize\n  return\n\ninitLayoutEngine()\n"]}